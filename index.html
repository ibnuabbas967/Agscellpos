<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoPOS Premium v4.5 | Sistem Kasir Terintegrasi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        .sidebar-transition { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .nav-active { background: #4f46e5; color: white !important; box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4); }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(226, 232, 240, 0.8); }
        .hide-scroll::-webkit-scrollbar { display: none; }
        input:focus, select:focus { border-color: #4f46e5; ring: 2px; ring-color: #4f46e5; outline: none; }
    </style>
</head>
<body class="text-slate-800">

    <div id="login-section" class="fixed inset-0 z-[100] bg-slate-950 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-10 shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full -mr-16 -mt-16"></div>
            <div class="text-center mb-8 relative">
                <div class="bg-indigo-600 w-20 h-20 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-xl shadow-indigo-200">
                    <i data-lucide="shield-check" class="text-white w-10 h-10"></i>
                </div>
                <h1 class="text-3xl font-black text-slate-900 tracking-tight">NeoPOS <span class="text-indigo-600">Pro</span></h1>
                <p class="text-slate-500 font-medium">Sistem Keuangan Digital Premium</p>
            </div>
            <div class="space-y-4">
                <button onclick="handleLogin('admin')" class="w-full group flex items-center justify-between p-5 border-2 border-slate-100 rounded-3xl hover:border-indigo-500 hover:bg-indigo-50 transition-all">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-slate-100 rounded-2xl group-hover:bg-white"><i data-lucide="user-cog" class="text-slate-500 group-hover:text-indigo-600"></i></div>
                        <span class="font-bold text-slate-700">Login Administrator</span>
                    </div>
                    <i data-lucide="chevron-right" class="text-slate-300"></i>
                </button>
                <button onclick="handleLogin('kasir')" class="w-full group flex items-center justify-between p-5 border-2 border-slate-100 rounded-3xl hover:border-indigo-500 hover:bg-indigo-50 transition-all">
                    <div class="flex items-center gap-4">
                        <div class="p-3 bg-slate-100 rounded-2xl group-hover:bg-white"><i data-lucide="shopping-cart" class="text-slate-500 group-hover:text-indigo-600"></i></div>
                        <span class="font-bold text-slate-700">Login Petugas Kasir</span>
                    </div>
                    <i data-lucide="chevron-right" class="text-slate-300"></i>
                </button>
            </div>
            <div class="mt-8 text-center"><p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Version 4.5.0 Stable Edition</p></div>
        </div>
    </div>

    <div class="flex min-h-screen">
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 bg-slate-900 text-slate-400 sidebar-transition -translate-x-full lg:translate-x-0 overflow-y-auto hide-scroll">
            <div class="p-8 flex items-center gap-3 border-b border-slate-800/50">
                <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white font-black">N</div>
                <div class="leading-none">
                    <p class="text-white font-black text-xl tracking-tighter">NeoPOS</p>
                    <p class="text-[10px] text-indigo-400 font-bold tracking-widest uppercase">Premium Edition</p>
                </div>
            </div>

            <nav class="p-4 mt-4 space-y-1">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest px-4 mb-2">Utama</p>
                <a href="#" onclick="switchPage('dashboard', this)" class="nav-item flex items-center gap-3 p-4 rounded-2xl hover:text-white transition-all nav-active">
                    <i data-lucide="layout-grid" class="w-5 h-5"></i> Dashboard Saldo
                </a>
                
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest px-4 mt-6 mb-2">Transaksi</p>
                <a href="#" onclick="switchPage('transaksi-digital', this)" class="nav-item flex items-center gap-3 p-4 rounded-2xl hover:text-white transition-all">
                    <i data-lucide="zap" class="w-5 h-5"></i> Transaksi Digital
                </a>
                <a href="#" onclick="switchPage('ewallet', this)" class="nav-item flex items-center gap-3 p-4 rounded-2xl hover:text-white transition-all">
                    <i data-lucide="smartphone" class="w-5 h-5"></i> Menu E-Wallet
                </a>
                <a href="#" onclick="switchPage('hutang-piutang', this)" class="nav-item flex items-center gap-3 p-4 rounded-2xl hover:text-white transition-all">
                    <i data-lucide="book-open" class="w-5 h-5"></i> Hutang & Piutang
                </a>
                <a href="#" onclick="switchPage('pengeluaran', this)" class="nav-item flex items-center gap-3 p-4 rounded-2xl hover:text-white transition-all">
                    <i data-lucide="trending-down" class="w-5 h-5"></i> Pengeluaran
                </a>

                <div id="admin-only-menu">
                    <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest px-4 mt-6 mb-2">Manajemen</p>
                    <a href="#" onclick="switchPage('grafik-profit', this)" class="nav-item flex items-center gap-3 p-4 rounded-2xl hover:text-white transition-all">
                        <i data-lucide="pie-chart" class="w-5 h-5"></i> Grafik & Profit
                    </a>
                    <a href="#" onclick="switchPage('kelola-barang', this)" class="nav-item flex items-center gap-3 p-4 rounded-2xl hover:text-white transition-all">
                        <i data-lucide="package" class="w-5 h-5"></i> Kelola Barang
                    </a>
                </div>

                <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest px-4 mt-6 mb-2">Sistem</p>
                <a href="#" onclick="switchPage('pengaturan', this)" class="nav-item flex items-center gap-3 p-4 rounded-2xl hover:text-white transition-all">
                    <i data-lucide="settings" class="w-5 h-5"></i> Pengaturan
                </a>
                <a href="javascript:location.reload()" class="flex items-center gap-3 p-4 rounded-2xl text-rose-500 hover:bg-rose-500/10 transition-all">
                    <i data-lucide="power" class="w-5 h-5"></i> Keluar Sistem
                </a>
            </nav>

            <div class="m-6 p-4 bg-slate-800/50 rounded-2xl border border-slate-700/50">
                <p class="text-[10px] text-slate-500 font-bold uppercase">Database Terhubung</p>
                <p class="text-xs text-emerald-400 font-bold flex items-center gap-1">
                    <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span> Google Sheets Active
                </p>
            </div>
        </aside>

        <main class="flex-1 lg:ml-72 min-h-screen sidebar-transition">
            <header class="lg:hidden p-4 bg-white border-b sticky top-0 z-40 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">N</div>
                    <span class="font-black text-slate-900 tracking-tighter">NeoPOS</span>
                </div>
                <button onclick="toggleSidebar()" class="p-2 bg-slate-100 rounded-xl text-slate-600">
                    <i data-lucide="menu"></i>
                </button>
            </header>

            <div class="p-4 lg:p-10">
                
                <section id="page-dashboard" class="page-view space-y-6">
                    <div class="flex justify-between items-end mb-6">
                        <div>
                            <h2 class="text-3xl font-black text-slate-900 tracking-tight">Status Keuangan</h2>
                            <p class="text-slate-500 font-medium">Real-time monitoring kas & bank</p>
                        </div>
                        <div class="hidden md:block bg-white px-4 py-2 rounded-2xl border text-sm font-bold text-slate-600" id="current-date">--:--</div>
                    </div>

                    <div class="flex flex-col gap-5 max-w-2xl">
                        <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 flex items-center gap-8 relative overflow-hidden group">
                            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:scale-110 transition-transform"><i data-lucide="banknote" class="w-24 h-24"></i></div>
                            <div class="bg-indigo-100 p-5 rounded-3xl text-indigo-600 shadow-inner"><i data-lucide="banknote" class="w-8 h-8"></i></div>
                            <div>
                                <p class="text-xs font-black text-slate-400 uppercase tracking-widest mb-1">Total Uang Kas (Laci)</p>
                                <h3 class="text-4xl font-black text-slate-900" id="dash-kas">Rp 0</h3>
                            </div>
                        </div>

                        <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 flex items-center gap-8 relative overflow-hidden group">
                            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:scale-110 transition-transform"><i data-lucide="landmark" class="w-24 h-24"></i></div>
                            <div class="bg-sky-100 p-5 rounded-3xl text-sky-600 shadow-inner"><i data-lucide="landmark" class="w-8 h-8"></i></div>
                            <div>
                                <p class="text-xs font-black text-slate-400 uppercase tracking-widest mb-1">Saldo Bank Digital</p>
                                <h3 class="text-4xl font-black text-slate-900" id="dash-bank">Rp 0</h3>
                            </div>
                        </div>

                        <div class="bg-slate-900 p-10 rounded-[3rem] text-white shadow-2xl shadow-indigo-200 relative overflow-hidden">
                            <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-indigo-500/20 rounded-full blur-3xl"></div>
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <p class="text-indigo-300 text-xs font-black uppercase tracking-widest mb-2">Total Aset Keseluruhan</p>
                                    <h3 class="text-5xl font-black tracking-tighter" id="dash-total">Rp 0</h3>
                                </div>
                                <div class="bg-white/10 p-4 rounded-2xl backdrop-blur-md border border-white/10"><i data-lucide="wallet"></i></div>
                            </div>
                            <div class="flex gap-4">
                                <span class="px-4 py-1.5 bg-emerald-500/20 text-emerald-400 text-[10px] font-black rounded-full border border-emerald-500/20">OPERASIONAL AMAN</span>
                                <span class="px-4 py-1.5 bg-white/5 text-white/50 text-[10px] font-black rounded-full border border-white/10">PREMIUM ACCOUNT</span>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="page-transaksi-digital" class="page-view hidden space-y-6">
                    <div class="bg-white p-8 lg:p-10 rounded-[3rem] shadow-sm border">
                        <h3 class="text-2xl font-black text-slate-900 mb-8 flex items-center gap-3">
                            <i data-lucide="zap" class="text-yellow-500"></i> Tagihan Listrik & PDAM
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="md:col-span-2">
                                <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Pilih/Input Pelanggan</label>
                                <input type="text" id="dg-pelanggan" placeholder="Nama Pelanggan (Opsional)" class="w-full p-5 rounded-2xl bg-slate-50 border border-slate-200 font-bold">
                            </div>
                            <div>
                                <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Jenis Layanan</label>
                                <select id="dg-jenis" class="w-full p-5 rounded-2xl bg-slate-50 border border-slate-200 font-bold">
                                    <option>Listrik Pascabayar</option>
                                    <option>Token Listrik</option>
                                    <option>Tagihan PDAM</option>
                                    <option>Internet / TV Kabel</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Metode Pembayaran</label>
                                <select id="dg-metode" class="w-full p-5 rounded-2xl bg-slate-50 border border-slate-200 font-bold">
                                    <option value="kas">Uang Kas (Laci)</option>
                                    <option value="bank">Saldo Bank</option>
                                </select>
                            </div>
                            <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-50 p-6 rounded-[2rem] border border-dashed border-slate-300">
                                <div>
                                    <label class="text-xs font-black text-indigo-500 uppercase tracking-widest block mb-2">Harga Modal (Potong Bank)</label>
                                    <input type="number" id="dg-modal" placeholder="Rp 0" class="w-full p-5 rounded-2xl bg-white border border-slate-200 font-black text-indigo-600">
                                </div>
                                <div>
                                    <label class="text-xs font-black text-emerald-500 uppercase tracking-widest block mb-2">Harga Jual (Total Bayar)</label>
                                    <input type="number" id="dg-jual" placeholder="Rp 0" class="w-full p-5 rounded-2xl bg-white border border-slate-200 font-black text-emerald-600">
                                </div>
                            </div>
                            <div class="md:col-span-2">
                                <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Status Pembayaran</label>
                                <div class="grid grid-cols-3 gap-3">
                                    <button onclick="setDgType('full', this)" class="dg-type-btn p-4 rounded-2xl border-2 border-indigo-600 bg-indigo-50 text-indigo-600 font-bold text-sm">Bayar Penuh</button>
                                    <button onclick="setDgType('sebagian', this)" class="dg-type-btn p-4 rounded-2xl border-2 border-slate-100 bg-white text-slate-500 font-bold text-sm">Sebagian</button>
                                    <button onclick="setDgType('hutang', this)" class="dg-type-btn p-4 rounded-2xl border-2 border-slate-100 bg-white text-slate-500 font-bold text-sm">Hutang Full</button>
                                </div>
                            </div>
                        </div>
                        <button onclick="saveDigitalTransaction()" class="w-full bg-indigo-600 text-white p-6 rounded-[2rem] font-black text-lg shadow-xl shadow-indigo-200 hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-3">
                            <i data-lucide="check-circle"></i> PROSES TRANSAKSI SEKARANG
                        </button>
                    </div>

                    <div class="bg-white p-8 rounded-[2.5rem] border shadow-sm">
                        <h4 class="font-black text-slate-900 mb-6">Riwayat Transaksi Digital Terakhir</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="text-[10px] font-black text-slate-400 uppercase tracking-widest border-b">
                                    <tr>
                                        <th class="text-left pb-4">Produk / Waktu</th>
                                        <th class="text-left pb-4">Pelanggan</th>
                                        <th class="text-right pb-4">Modal</th>
                                        <th class="text-right pb-4">Jual</th>
                                        <th class="text-center pb-4">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="table-dg-history" class="text-sm font-bold text-slate-700">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="page-ewallet" class="page-view hidden space-y-6">
                    <div class="bg-white p-8 lg:p-10 rounded-[3rem] shadow-sm border">
                        <h3 class="text-2xl font-black text-slate-900 mb-8">Transaksi E-Wallet</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div>
                                <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Tipe Transaksi</label>
                                <select id="ew-jenis" onchange="updateEwAlur()" class="w-full p-5 rounded-2xl bg-indigo-50 border-2 border-indigo-100 font-black text-indigo-700">
                                    <option value="topup">1. TOPUP DANA (Pelanggan Beli)</option>
                                    <option value="tarik">2. TARIK TUNAI (Pelanggan Cairkan)</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Biaya Admin</label>
                                <select id="ew-admin-pos" class="w-full p-5 rounded-2xl bg-slate-50 border border-slate-200 font-bold">
                                    <option value="luar">DI LUAR (Harga + Admin)</option>
                                    <option value="dalam">DI DALAM (Potong Saldo)</option>
                                </select>
                            </div>

                            <div class="md:col-span-2 p-6 rounded-[2rem] bg-indigo-600 text-white flex items-start gap-4 shadow-xl shadow-indigo-100" id="ew-notif-box">
                                <div class="p-3 bg-white/20 rounded-2xl"><i data-lucide="info"></i></div>
                                <div>
                                    <p class="font-black text-lg" id="ew-notif-title">Pemasukan (Uang Kas Masuk)</p>
                                    <p class="text-sm text-indigo-100 font-medium" id="ew-notif-desc">Pelanggan memberikan uang CASH ke Kasir, kita mentransfer SALDO Digital kita ke mereka.</p>
                                </div>
                            </div>

                            <div>
                                <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Nominal Saldo</label>
                                <input type="number" id="ew-nominal" placeholder="Rp 0" class="w-full p-5 rounded-2xl bg-slate-50 border border-slate-200 font-black">
                            </div>
                            <div>
                                <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Admin Toko</label>
                                <input type="number" id="ew-admin-val" value="2000" class="w-full p-5 rounded-2xl bg-slate-50 border border-slate-200 font-black text-emerald-600">
                            </div>
                        </div>
                        <button onclick="saveEwalletTransaction()" class="w-full bg-slate-900 text-white p-6 rounded-[2rem] font-black text-lg shadow-xl hover:bg-black transition-all">SIMPAN DATA E-WALLET</button>
                    </div>

                    <div class="bg-white p-8 rounded-[2.5rem] border shadow-sm">
                        <h4 class="font-black text-slate-900 mb-6">Riwayat E-Wallet</h4>
                        <div id="ew-history-list" class="space-y-4">
                            </div>
                    </div>
                </section>

                <section id="page-hutang-piutang" class="page-view hidden space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-white p-8 rounded-[3rem] shadow-sm border">
                            <h3 class="text-xl font-black text-slate-900 mb-6 flex justify-between items-center">
                                Piutang Pelanggan 
                                <span class="bg-rose-100 text-rose-600 text-[10px] font-black px-3 py-1 rounded-full">DILUAR</span>
                            </h3>
                            <div id="piutang-container" class="space-y-4">
                                </div>
                        </div>

                        <div class="bg-slate-900 p-8 rounded-[3rem] text-white shadow-2xl">
                            <h3 class="text-xl font-black mb-6 flex justify-between items-center">
                                Hutang Toko
                                <span class="bg-white/10 text-white text-[10px] font-black px-3 py-1 rounded-full">KEWAJIBAN</span>
                            </h3>
                            <div id="hutang-container" class="space-y-4">
                                <div class="p-6 bg-white/5 rounded-3xl border border-white/10 flex justify-between items-center">
                                    <div>
                                        <p class="font-black text-white">Distributor Utama</p>
                                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Tagihan Saldo</p>
                                        <p class="text-xl font-black text-indigo-400 mt-1">Rp 1.500.000</p>
                                    </div>
                                    <button class="bg-white text-slate-900 px-5 py-2.5 rounded-2xl text-xs font-black shadow-lg">BAYAR</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="page-grafik-profit" class="page-view hidden space-y-8">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-white p-8 rounded-[3rem] border shadow-sm">
                            <h3 class="font-black mb-6 flex items-center gap-2"><i data-lucide="line-chart"></i> Pertumbuhan Penjualan</h3>
                            <canvas id="chart-penjualan" height="250"></canvas>
                        </div>
                        <div class="bg-white p-8 rounded-[3rem] border shadow-sm">
                            <h3 class="font-black mb-6 flex items-center gap-2"><i data-lucide="pie-chart"></i> Produk Terlaris</h3>
                            <div class="max-w-[280px] mx-auto">
                                <canvas id="chart-produk" height="280"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-900 p-10 rounded-[3rem] text-white">
                        <h3 class="text-xl font-black mb-8 border-b border-white/10 pb-4">Rangkuman Keuntungan (Profit)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                            <div>
                                <p class="text-slate-500 text-[10px] font-black uppercase tracking-widest mb-2">Profit Hari Ini</p>
                                <h4 class="text-3xl font-black text-emerald-400" id="prof-hari">Rp 0</h4>
                                <p class="text-[10px] text-slate-400 mt-2 font-bold">+ 12% dari kemarin</p>
                            </div>
                            <div>
                                <p class="text-slate-500 text-[10px] font-black uppercase tracking-widest mb-2">Profit Minggu Ini</p>
                                <h4 class="text-3xl font-black text-indigo-400" id="prof-minggu">Rp 0</h4>
                                <p class="text-[10px] text-slate-400 mt-2 font-bold">+ 5% dari minggu lalu</p>
                            </div>
                            <div>
                                <p class="text-slate-500 text-[10px] font-black uppercase tracking-widest mb-2">Total Akumulasi</p>
                                <h4 class="text-3xl font-black text-white" id="prof-total">Rp 0</h4>
                                <p class="text-[10px] text-emerald-500 mt-2 font-bold">Target Terpenuhi</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="page-pengaturan" class="page-view hidden">
                    <div class="max-w-2xl mx-auto bg-white p-10 rounded-[3rem] border shadow-sm">
                        <h3 class="text-2xl font-black mb-8 border-b pb-4">Sistem Konfigurasi</h3>
                        <div class="space-y-6">
                            <div class="grid grid-cols-2 gap-6">
                                <div>
                                    <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Modal Awal Kas</label>
                                    <input type="number" id="set-kas" class="w-full p-5 rounded-2xl bg-slate-50 border border-slate-200 font-black">
                                </div>
                                <div>
                                    <label class="text-xs font-black text-slate-400 uppercase tracking-widest block mb-2">Modal Awal Bank</label>
                                    <input type="number" id="set-bank" class="w-full p-5 rounded-2xl bg-slate-50 border border-slate-200 font-black">
                                </div>
                            </div>
                            <button onclick="saveSettings()" class="w-full bg-indigo-600 text-white p-5 rounded-[2rem] font-black text-lg shadow-xl shadow-indigo-100">SIMPAN PENGATURAN</button>
                            
                            <div class="pt-10 space-y-4">
                                <p class="text-center text-[10px] font-black text-slate-400 uppercase tracking-widest">Informasi Sistem</p>
                                <div class="flex justify-between text-sm font-bold border-b pb-3"><span>Versi Aplikasi</span><span class="text-indigo-600">4.5.0 Premium</span></div>
                                <div class="flex justify-between text-sm font-bold border-b pb-3"><span>Tipe Lisensi</span><span class="text-emerald-600">Enterprise</span></div>
                                <div class="flex justify-between text-sm font-bold border-b pb-3"><span>Penyimpanan</span><span class="text-slate-600">Google Apps Script</span></div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <script>
        // DATA STATE
        let db = {
            role: 'admin',
            saldoKas: 0,
            saldoBank: 0,
            piutang: [],
            digitalHistory: [],
            ewHistory: [],
            profit: 0,
            dgType: 'full'
        };

        const rf = (n) => "Rp " + new Intl.NumberFormat('id-ID').format(n);

        // LOGIN SYSTEM
        function handleLogin(role) {
            db.role = role;
            document.getElementById('login-section').classList.add('hidden');
            if(role === 'kasir') document.getElementById('admin-only-menu').style.display = 'none';
            Swal.fire({
                title: 'Akses Berhasil!',
                text: `Selamat bekerja sebagai ${role.toUpperCase()}`,
                icon: 'success',
                confirmButtonColor: '#4f46e5'
            });
            refreshUI();
        }

        // NAVIGATION
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
        }

        function switchPage(pageId, el) {
            document.querySelectorAll('.page-view').forEach(p => p.classList.add('hidden'));
            document.getElementById(`page-${pageId}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active'));
            el.classList.add('nav-active');

            if(window.innerWidth < 1024) toggleSidebar();
            if(pageId === 'grafik-profit') initCharts();
            lucide.createIcons();
            refreshUI();
        }

        // LOGIKA TRANSAKSI DIGITAL
        function setDgType(type, el) {
            db.dgType = type;
            document.querySelectorAll('.dg-type-btn').forEach(b => {
                b.classList.remove('border-indigo-600', 'bg-indigo-50', 'text-indigo-600');
                b.classList.add('border-slate-100', 'bg-white', 'text-slate-500');
            });
            el.classList.remove('border-slate-100', 'bg-white', 'text-slate-500');
            el.classList.add('border-indigo-600', 'bg-indigo-50', 'text-indigo-600');
        }

        function saveDigitalTransaction() {
            const modal = parseInt(document.getElementById('dg-modal').value) || 0;
            const jual = parseInt(document.getElementById('dg-jual').value) || 0;
            const nama = document.getElementById('dg-pelanggan').value || 'Umum';
            const jenis = document.getElementById('dg-jenis').value;
            const metode = document.getElementById('dg-metode').value;

            if(modal <= 0 || jual <= 0) return Swal.fire('Error', 'Input harga tidak valid', 'error');
            if(db.saldoBank < modal) return Swal.fire('Gagal', 'Saldo Bank tidak cukup untuk modal!', 'warning');

            // Eksekusi
            db.saldoBank -= modal;
            let profit = jual - modal;
            
            if(db.dgType === 'full') {
                if(metode === 'kas') db.saldoKas += jual; else db.saldoBank += jual;
            } else if(db.dgType === 'sebagian') {
                let dp = jual / 2;
                if(metode === 'kas') db.saldoKas += dp; else db.saldoBank += dp;
                db.piutang.push({ nama, total: jual - dp, tipe: 'Sisa Digital' });
            } else {
                db.piutang.push({ nama, total: jual, tipe: 'Hutang Digital' });
            }

            db.profit += profit;
            db.digitalHistory.push({ id: Date.now(), jenis, nama, modal, jual, tgl: new Date().toLocaleTimeString(), profit, metode });
            
            syncToSheets({ action: 'digital', data: db.digitalHistory[db.digitalHistory.length-1] });
            Swal.fire('Sukses', 'Transaksi Digital Disimpan', 'success');
            refreshUI();
            
            // Clear
            document.getElementById('dg-modal').value = '';
            document.getElementById('dg-jual').value = '';
        }

        function deleteDigital(id) {
            const item = db.digitalHistory.find(i => i.id === id);
            // Normalkan
            db.saldoBank += item.modal;
            if(item.metode === 'kas') db.saldoKas -= item.jual; else db.saldoBank -= item.jual;
            db.profit -= item.profit;
            db.digitalHistory = db.digitalHistory.filter(i => i.id !== id);
            Swal.fire('Terhapus', 'Saldo telah dikembalikan', 'info');
            refreshUI();
        }

        // LOGIKA E-WALLET
        function updateEwAlur() {
            const jenis = document.getElementById('ew-jenis').value;
            const box = document.getElementById('ew-notif-box');
            const title = document.getElementById('ew-notif-title');
            const desc = document.getElementById('ew-notif-desc');

            if(jenis === 'topup') {
                box.className = 'md:col-span-2 p-6 rounded-[2rem] bg-indigo-600 text-white flex items-start gap-4 shadow-xl shadow-indigo-100';
                title.innerText = 'Pemasukan (Uang Kas Masuk)';
                desc.innerText = 'Pelanggan memberikan uang CASH ke Kasir, kita mentransfer SALDO Digital kita ke mereka.';
            } else {
                box.className = 'md:col-span-2 p-6 rounded-[2rem] bg-emerald-600 text-white flex items-start gap-4 shadow-xl shadow-emerald-100';
                title.innerText = 'Pengeluaran (Uang Kas Keluar)';
                desc.innerText = 'Pelanggan mentransfer SALDO ke kita, kita memberikan uang CASH dari laci kasir ke mereka.';
            }
            lucide.createIcons();
        }

        function saveEwalletTransaction() {
            const nominal = parseInt(document.getElementById('ew-nominal').value) || 0;
            const admin = parseInt(document.getElementById('ew-admin-val').value) || 0;
            const jenis = document.getElementById('ew-jenis').value;
            const posisi = document.getElementById('ew-admin-pos').value;

            if(nominal <= 0) return Swal.fire('Error', 'Input nominal kosong', 'error');

            if(jenis === 'topup') {
                db.saldoBank -= nominal; // Saldo digital kita keluar
                let bayar = (posisi === 'luar') ? nominal + admin : nominal;
                db.saldoKas += bayar; // Pelanggan kasih cash
                db.profit += admin;
            } else {
                db.saldoBank += nominal; // Kita terima saldo
                let tarik = (posisi === 'luar') ? nominal : nominal - admin;
                db.saldoKas -= tarik; // Kita kasih cash ke pelanggan
                db.profit += admin;
            }

            db.ewHistory.push({ id: Date.now(), jenis, nominal, admin, tgl: new Date().toLocaleTimeString() });
            Swal.fire('Sukses', 'E-Wallet Berhasil diproses', 'success');
            refreshUI();
        }

        function deleteEw(id) {
            db.ewHistory = db.ewHistory.filter(i => i.id !== id);
            refreshUI();
        }

        // SYSTEM UI REFRESH
        function refreshUI() {
            document.getElementById('dash-kas').innerText = rf(db.saldoKas);
            document.getElementById('dash-bank').innerText = rf(db.saldoBank);
            document.getElementById('dash-total').innerText = rf(db.saldoKas + db.saldoBank);
            document.getElementById('prof-hari').innerText = rf(db.profit);
            document.getElementById('prof-total').innerText = rf(db.profit);

            // Table Digital
            const tableDg = document.getElementById('table-dg-history');
            tableDg.innerHTML = db.digitalHistory.map(t => `
                <tr class="border-b border-slate-50 hover:bg-slate-50 transition">
                    <td class="py-4">
                        <p>${t.jenis}</p>
                        <p class="text-[10px] text-slate-400 font-bold tracking-widest uppercase">${t.tgl}</p>
                    </td>
                    <td class="py-4 text-slate-500">${t.nama}</td>
                    <td class="py-4 text-right text-rose-500">${rf(t.modal)}</td>
                    <td class="py-4 text-right text-indigo-600">${rf(t.jual)}</td>
                    <td class="py-4 text-center">
                        <button onclick="deleteDigital(${t.id})" class="text-rose-400 hover:text-rose-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </td>
                </tr>
            `).reverse().join('');

            // EW List
            const ewList = document.getElementById('ew-history-list');
            ewList.innerHTML = db.ewHistory.map(e => `
                <div class="flex items-center justify-between p-5 bg-slate-50 rounded-2xl border border-slate-100 group">
                    <div class="flex items-center gap-4">
                        <div class="p-3 ${e.jenis === 'topup' ? 'bg-indigo-100 text-indigo-600' : 'bg-emerald-100 text-emerald-600'} rounded-xl font-black text-xs uppercase">${e.jenis}</div>
                        <div><p class="font-black text-slate-800">${rf(e.nominal)}</p><p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">${e.tgl}</p></div>
                    </div>
                    <button onclick="deleteEw(${e.id})" class="opacity-0 group-hover:opacity-100 transition p-2 text-rose-500"><i data-lucide="x-circle"></i></button>
                </div>
            `).reverse().join('');

            // Piutang
            const pList = document.getElementById('piutang-container');
            pList.innerHTML = db.piutang.map((p, i) => `
                <div class="p-6 bg-slate-50 rounded-3xl border flex justify-between items-center">
                    <div>
                        <p class="font-black text-slate-900">${p.nama}</p>
                        <p class="text-[10px] text-slate-400 font-bold uppercase">${p.tipe}</p>
                        <p class="text-xl font-black text-rose-600 mt-1">${rf(p.total)}</p>
                    </div>
                    <button onclick="db.piutang.splice(${i}, 1); refreshUI()" class="bg-indigo-600 text-white px-5 py-2.5 rounded-2xl text-xs font-black shadow-lg">LUNASI</button>
                </div>
            `).join('');

            lucide.createIcons();
        }

        function saveSettings() {
            db.saldoKas = parseInt(document.getElementById('set-kas').value) || 0;
            db.saldoBank = parseInt(document.getElementById('set-bank').value) || 0;
            Swal.fire('Disimpan', 'Modal awal telah diatur', 'success');
            refreshUI();
        }

        // CHART SYSTEM
        function initCharts() {
            const ctx1 = document.getElementById('chart-penjualan').getContext('2d');
            new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
                    datasets: [{
                        label: 'Profit Harian',
                        data: [12000, 19000, 3000, 50000, 22000, 30000, 45000],
                        borderColor: '#4f46e5',
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(79, 70, 229, 0.1)'
                    }]
                }
            });

            const ctx2 = document.getElementById('chart-produk').getContext('2d');
            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Digital', 'E-Wallet', 'Barang'],
                    datasets: [{
                        data: [45, 35, 20],
                        backgroundColor: ['#4f46e5', '#10b981', '#f59e0b']
                    }]
                }
            });
        }

        function syncToSheets(data) {
            // URL SCRIPT ANDA
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxE516Tqna_RKNuVgOpU0x9rnzf5O6lB0VOMLRKdVDYoIGRk89POCTiQzF8Q-1txjc40Q/exec";
            console.log("Syncing Data to Google Sheets...", data);
            // fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) });
        }

        setInterval(() => {
            document.getElementById('current-date').innerText = new Date().toLocaleString();
        }, 1000);

        window.onload = () => { refreshUI(); lucide.createIcons(); };
    </script>
</body>
</html>
