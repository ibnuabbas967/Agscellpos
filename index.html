<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoPOS Premium v3.5 - Advanced Fintech System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .sidebar-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .active-menu { background: #6366f1; color: white !important; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        .card-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); }
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="overflow-x-hidden">

    <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 bg-slate-900 text-slate-400 sidebar-transition -translate-x-full lg:translate-x-0 overflow-y-auto hide-scroll">
        <div class="p-6 flex items-center gap-3 border-b border-slate-800">
            <div class="bg-indigo-500 p-2 rounded-xl text-white">
                <i data-lucide="layout-dashboard"></i>
            </div>
            <span class="text-xl font-bold text-white tracking-tight">NeoPOS <span class="text-indigo-400">Pro</span></span>
        </div>

        <nav class="p-4 space-y-1">
            <p class="text-[10px] font-bold uppercase tracking-widest px-4 mb-2 text-slate-500">Menu Utama</p>
            <a href="#" onclick="showPage('dashboard')" class="nav-link flex items-center gap-3 p-3.5 rounded-xl hover:text-white transition active-menu">
                <i data-lucide="grid"></i> Dashboard Saldo
            </a>
            <a href="#" onclick="showPage('transaksi-digital')" class="nav-link flex items-center gap-3 p-3.5 rounded-xl hover:text-white transition">
                <i data-lucide="zap"></i> Transaksi Digital
            </a>
            <a href="#" onclick="showPage('ewallet')" class="nav-link flex items-center gap-3 p-3.5 rounded-xl hover:text-white transition">
                <i data-lucide="smartphone"></i> Menu E-Wallet
            </a>
            <a href="#" onclick="showPage('hutang-piutang')" class="nav-link flex items-center gap-3 p-3.5 rounded-xl hover:text-white transition">
                <i data-lucide="book-open"></i> Hutang & Piutang
            </a>
            <a href="#" onclick="showPage('pengeluaran')" class="nav-link flex items-center gap-3 p-3.5 rounded-xl hover:text-white transition">
                <i data-lucide="trending-down"></i> Pengeluaran
            </a>

            <p class="text-[10px] font-bold uppercase tracking-widest px-4 mt-8 mb-2 text-slate-500">Analisa & Produk</p>
            <a href="#" onclick="showPage('grafik')" class="nav-link flex items-center gap-3 p-3.5 rounded-xl hover:text-white transition">
                <i data-lucide="bar-chart-3"></i> Grafik & Profit
            </a>
            <a href="#" onclick="showPage('produk')" class="nav-link flex items-center gap-3 p-3.5 rounded-xl hover:text-white transition">
                <i data-lucide="package"></i> Kelola Barang
            </a>

            <p class="text-[10px] font-bold uppercase tracking-widest px-4 mt-8 mb-2 text-slate-500">Sistem</p>
            <a href="#" onclick="showPage('pengaturan')" class="nav-link flex items-center gap-3 p-3.5 rounded-xl hover:text-white transition">
                <i data-lucide="settings"></i> Pengaturan
            </a>
        </nav>

        <div class="mt-10 p-6 bg-slate-950 mx-4 rounded-2xl border border-slate-800">
            <p class="text-xs text-slate-500">Versi Website</p>
            <p class="text-sm font-bold text-white">v3.5 Premium Edition</p>
            <div class="mt-2 flex items-center gap-2 text-[10px] text-emerald-400">
                <span class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></span> Sistem Realtime Aktif
            </div>
        </div>
    </aside>

    <main class="lg:ml-72 min-h-screen">
        <header class="sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b p-4 flex justify-between items-center">
            <button onclick="toggleSidebar()" class="lg:hidden p-2 hover:bg-slate-100 rounded-lg">
                <i data-lucide="menu"></i>
            </button>
            <div class="flex items-center gap-4 ml-auto">
                <div class="text-right hidden sm:block">
                    <p class="text-xs text-slate-500 font-bold">Admin Terdeteksi</p>
                    <p class="text-sm font-bold">Owner NeoPOS</p>
                </div>
                <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold border-2 border-indigo-200">
                    A
                </div>
            </div>
        </header>

        <div class="p-4 lg:p-8">
            
            <section id="dashboard" class="page-content space-y-6">
                <h2 class="text-2xl font-extrabold flex items-center gap-2">
                    <i data-lucide="wallet" class="text-indigo-600"></i> Dashboard Saldo
                </h2>
                <div class="flex flex-col gap-4 max-w-2xl">
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 card-shadow flex items-center gap-6">
                        <div class="bg-indigo-100 p-4 rounded-2xl text-indigo-600"><i data-lucide="landmark"></i></div>
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Saldo Bank Saat Ini</p>
                            <h3 class="text-3xl font-black text-slate-800" id="v-saldo-bank">Rp 0</h3>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 card-shadow flex items-center gap-6">
                        <div class="bg-emerald-100 p-4 rounded-2xl text-emerald-600"><i data-lucide="banknote"></i></div>
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Total Uang Kas</p>
                            <h3 class="text-3xl font-black text-slate-800" id="v-saldo-kas">Rp 0</h3>
                        </div>
                    </div>
                    <div class="bg-slate-900 p-8 rounded-3xl shadow-xl shadow-indigo-100 text-white flex justify-between items-center">
                        <div>
                            <p class="text-indigo-300 text-xs font-bold uppercase tracking-widest mb-1">Total Keseluruhan Uang</p>
                            <h3 class="text-4xl font-black" id="v-total-gabungan">Rp 0</h3>
                        </div>
                        <i data-lucide="layers" class="w-12 h-12 text-indigo-500 opacity-50"></i>
                    </div>
                </div>
            </section>

            <section id="transaksi-digital" class="page-content hidden">
                <div class="max-w-4xl bg-white rounded-3xl p-8 border card-shadow">
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-indigo-600">
                        <i data-lucide="zap"></i> Form Pembelian Tagihan (PLN/PDAM)
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="md:col-span-2">
                            <label class="text-sm font-bold mb-1 block">Nama Pelanggan (Opsional)</label>
                            <input type="text" id="td-nama" class="w-full p-4 rounded-2xl bg-slate-50 border focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Contoh: Budi">
                        </div>
                        <div>
                            <label class="text-sm font-bold mb-1 block">Jenis Tagihan</label>
                            <select id="td-jenis" class="w-full p-4 rounded-2xl bg-slate-50 border">
                                <option>Tagihan Listrik PLN</option>
                                <option>Token Listrik</option>
                                <option>Tagihan PDAM Air</option>
                                <option>BPJS Kesehatan</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm font-bold mb-1 block">Harga Modal (Dari Saldo Bank)</label>
                            <input type="number" id="td-modal" class="w-full p-4 rounded-2xl bg-slate-50 border" placeholder="0">
                        </div>
                        <div>
                            <label class="text-sm font-bold mb-1 block">Harga Jual (Total Tagihan)</label>
                            <input type="number" id="td-jual" class="w-full p-4 rounded-2xl bg-slate-50 border" placeholder="0">
                        </div>
                        <div>
                            <label class="text-sm font-bold mb-1 block">Tipe Pembayaran</label>
                            <select id="td-tipe" class="w-full p-4 rounded-2xl bg-slate-50 border">
                                <option value="full">Bayar Penuh</option>
                                <option value="sebagian">Bayar Sebagian</option>
                                <option value="hutang">Hutang Full</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm font-bold mb-1 block">Metode (Uang Masuk Ke)</label>
                            <select id="td-metode" class="w-full p-4 rounded-2xl bg-slate-50 border">
                                <option value="kas">Saldo Kas/Laci Toko</option>
                                <option value="bank">Saldo Bank</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="prosesTransaksiDigital()" class="w-full bg-indigo-600 text-white p-5 rounded-2xl font-bold shadow-lg shadow-indigo-100 hover:bg-indigo-700 transition flex justify-center gap-2">
                        <i data-lucide="save"></i> Simpan Transaksi Digital
                    </button>
                    
                    <div class="mt-8 overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-[10px] uppercase font-bold text-slate-500">
                                <tr>
                                    <th class="p-4">Tanggal/Produk</th>
                                    <th class="p-4">Pelanggan</th>
                                    <th class="p-4 text-right">Modal</th>
                                    <th class="p-4 text-right">Jual</th>
                                    <th class="p-4 text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="list-history-digital"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="grafik" class="page-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-3xl border card-shadow">
                        <h3 class="font-bold mb-4 flex items-center gap-2"><i data-lucide="bar-chart"></i> Pertumbuhan Penjualan</h3>
                        <canvas id="chartGrowth" height="200"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border card-shadow">
                        <h3 class="font-bold mb-4 flex items-center gap-2"><i data-lucide="pie-chart"></i> Persentase Keuntungan</h3>
                        <div class="max-w-[300px] mx-auto">
                            <canvas id="chartProfit" height="300"></canvas>
                        </div>
                    </div>
                    <div class="lg:col-span-2 bg-white p-8 rounded-3xl border card-shadow">
                        <h3 class="text-xl font-bold mb-6">Detail Profit Keuntungan</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                            <div class="p-6 bg-emerald-50 rounded-2xl border border-emerald-100">
                                <p class="text-xs font-bold text-emerald-600 uppercase mb-1">Profit Hari Ini</p>
                                <h4 class="text-2xl font-black text-emerald-700" id="p-hari">Rp 0</h4>
                            </div>
                            <div class="p-6 bg-indigo-50 rounded-2xl border border-indigo-100">
                                <p class="text-xs font-bold text-indigo-600 uppercase mb-1">Profit Minggu Ini</p>
                                <h4 class="text-2xl font-black text-indigo-700" id="p-minggu">Rp 0</h4>
                            </div>
                            <div class="p-6 bg-slate-100 rounded-2xl border border-slate-200">
                                <p class="text-xs font-bold text-slate-600 uppercase mb-1">Profit Bulan Ini</p>
                                <h4 class="text-2xl font-black text-slate-700" id="p-bulan">Rp 0</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="hutang-piutang" class="page-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <div class="bg-white p-8 rounded-3xl border card-shadow">
                            <h3 class="text-xl font-black text-slate-800 flex items-center gap-2">
                                <i data-lucide="arrow-down-left" class="text-rose-500"></i> Piutang Pelanggan
                            </h3>
                            <p class="text-sm text-slate-500 mb-6 border-b pb-4">Daftar uang toko yang masih ada di pelanggan</p>
                            <div id="view-piutang" class="space-y-4">
                                </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-slate-900 p-8 rounded-3xl text-white shadow-xl shadow-slate-200">
                            <h3 class="text-xl font-black flex items-center gap-2">
                                <i data-lucide="arrow-up-right" class="text-emerald-400"></i> Hutang Toko (Piutang Pihak Lain)
                            </h3>
                            <p class="text-sm text-slate-400 mb-6 border-b border-slate-800 pb-4">Daftar kewajiban toko yang harus dibayar</p>
                            <div id="view-hutang-toko" class="space-y-4 text-slate-300">
                                <div class="bg-slate-800 p-4 rounded-2xl flex justify-between items-center border border-slate-700">
                                    <div>
                                        <p class="font-bold text-white">Distributor Saldo PLN</p>
                                        <p class="text-[10px] text-slate-400">Tempo: 28 Feb 2026</p>
                                        <p class="text-lg font-black text-emerald-400">Rp 2.500.000</p>
                                    </div>
                                    <button class="bg-indigo-600 px-4 py-2 rounded-xl text-xs font-bold text-white">Bayar Hutang</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="pengaturan" class="page-content hidden">
                <div class="max-w-xl mx-auto bg-white p-8 rounded-3xl border card-shadow">
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-2"><i data-lucide="sliders"></i> Set Awal Modal</h2>
                    <div class="space-y-4 mb-8">
                        <div>
                            <label class="text-sm font-bold block mb-1">Set Modal Awal Kas Toko</label>
                            <input type="number" id="set-kas" class="w-full p-4 rounded-2xl bg-slate-50 border focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Rp 0">
                        </div>
                        <div>
                            <label class="text-sm font-bold block mb-1">Set Modal Awal Saldo Bank</label>
                            <input type="number" id="set-bank" class="w-full p-4 rounded-2xl bg-slate-50 border focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Rp 0">
                        </div>
                        <button onclick="saveInitialSettings()" class="w-full bg-slate-900 text-white p-4 rounded-2xl font-bold hover:bg-black transition">Terapkan Pengaturan Modal</button>
                    </div>
                    <div class="pt-6 border-t text-center">
                        <p class="text-xs text-slate-400 font-bold uppercase tracking-widest">NeoPOS System Info</p>
                        <p class="text-sm text-slate-600">Premium Version 3.5.0 Stable Edition</p>
                        <p class="text-[10px] text-indigo-500 font-bold mt-1">Engine: Google Apps Script & Tailwind Framework</p>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <script>
        // --- DATA STATE ---
        let db = {
            saldoKas: 0,
            saldoBank: 0,
            transaksiDigital: [],
            piutang: [],
            profit: 0
        };

        // --- CORE UI LOGIC ---
        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            sb.classList.toggle('-translate-x-full');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            
            // Update Active Menu
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active-menu');
                if(link.getAttribute('onclick').includes(pageId)) link.classList.add('active-menu');
            });

            if(window.innerWidth < 1024) toggleSidebar();
            if(pageId === 'grafik') renderCharts();
            lucide.createIcons();
            updateDashboard();
        }

        const rf = (num) => "Rp " + new Intl.NumberFormat('id-ID').format(num);

        function updateDashboard() {
            document.getElementById('v-saldo-bank').innerText = rf(db.saldoBank);
            document.getElementById('v-saldo-kas').innerText = rf(db.saldoKas);
            document.getElementById('v-total-gabungan').innerText = rf(db.saldoBank + db.saldoKas);

            // History Transaksi Digital
            const listTBody = document.getElementById('list-history-digital');
            listTBody.innerHTML = db.transaksiDigital.map((t, idx) => `
                <tr class="border-b text-sm">
                    <td class="p-4">
                        <p class="font-bold">${t.jenis}</p>
                        <p class="text-[10px] text-slate-400">${t.tgl}</p>
                    </td>
                    <td class="p-4 font-medium">${t.nama}</td>
                    <td class="p-4 text-right text-rose-500 font-bold">${rf(t.modal)}</td>
                    <td class="p-4 text-right text-indigo-600 font-bold">${rf(t.jual)}</td>
                    <td class="p-4 text-center">
                        <button onclick="hapusTransaksiDigital(${idx})" class="p-2 text-rose-500 hover:bg-rose-50 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </td>
                </tr>
            `).reverse().join('');

            // Piutang List
            const pView = document.getElementById('view-piutang');
            pView.innerHTML = db.piutang.length ? '' : '<p class="text-center text-slate-400 text-sm py-4">Belum ada piutang</p>';
            db.piutang.forEach((p, i) => {
                pView.innerHTML += `
                    <div class="bg-rose-50 p-4 rounded-2xl flex justify-between items-center border border-rose-100">
                        <div>
                            <p class="font-bold text-slate-800">${p.nama}</p>
                            <p class="text-xs text-slate-500">Sisa Tagihan:</p>
                            <p class="text-lg font-black text-rose-600">${rf(p.nominal)}</p>
                        </div>
                        <button onclick="bayarPiutang(${i})" class="bg-rose-600 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg shadow-rose-100">Bayar</button>
                    </div>
                `;
            });

            // Update Profit Stats
            document.getElementById('p-hari').innerText = rf(db.profit);
            document.getElementById('p-minggu').innerText = rf(db.profit * 1.5); // dummy ratio
            document.getElementById('p-bulan').innerText = rf(db.profit * 2.1); // dummy ratio

            lucide.createIcons();
        }

        // --- TRANSACTION LOGIC ---
        function prosesTransaksiDigital() {
            const modal = parseInt(document.getElementById('td-modal').value) || 0;
            const jual = parseInt(document.getElementById('td-jual').value) || 0;
            const nama = document.getElementById('td-nama').value || 'Pelanggan Umum';
            const jenis = document.getElementById('td-jenis').value;
            const tipe = document.getElementById('td-tipe').value;
            const metode = document.getElementById('td-metode').value;

            if(modal <= 0 || jual <= 0) return Swal.fire('Error', 'Harga modal dan jual harus diisi!', 'error');
            if(db.saldoBank < modal) return Swal.fire('Gagal', 'Saldo Bank tidak mencukupi untuk harga modal!', 'warning');

            // 1. Kurangi Saldo Bank untuk modal
            db.saldoBank -= modal;

            // 2. Hitung Profit Bersih
            let profitTx = jual - modal;

            // 3. Logika Uang Masuk & Piutang
            if(tipe === 'full') {
                if(metode === 'kas') db.saldoKas += jual;
                else db.saldoBank += jual;
            } else if(tipe === 'sebagian') {
                let bayarAwal = jual / 2;
                if(metode === 'kas') db.saldoKas += bayarAwal;
                else db.saldoBank += bayarAwal;
                db.piutang.push({ nama, nominal: jual - bayarAwal });
            } else {
                db.piutang.push({ nama, nominal: jual });
            }

            // 4. Save to DB
            db.transaksiDigital.push({
                jenis, nama, modal, jual, metode, profit: profitTx, tgl: new Date().toLocaleTimeString()
            });
            db.profit += profitTx;

            Swal.fire({
                title: 'Berhasil!',
                text: 'Transaksi digital berhasil dicatat.',
                icon: 'success',
                timer: 1500
            });
            
            updateDashboard();
            resetDigitalForm();
        }

        function hapusTransaksiDigital(index) {
            const t = db.transaksiDigital[index];
            // Normalkan Saldo: Balikkan Modal ke Bank, Kurangi Kas dari Penjualan
            db.saldoBank += t.modal;
            if(t.metode === 'kas') db.saldoKas -= t.jual;
            else db.saldoBank -= t.jual;
            
            db.profit -= t.profit;
            db.transaksiDigital.splice(index, 1);
            updateDashboard();
            Swal.fire('Terhapus', 'Saldo telah dinormalkan kembali', 'info');
        }

        function saveInitialSettings() {
            db.saldoKas = parseInt(document.getElementById('set-kas').value) || 0;
            db.saldoBank = parseInt(document.getElementById('set-bank').value) || 0;
            updateDashboard();
            Swal.fire('Berhasil', 'Pengaturan modal awal tersimpan', 'success');
        }

        function resetDigitalForm() {
            document.getElementById('td-modal').value = '';
            document.getElementById('td-jual').value = '';
            document.getElementById('td-nama').value = '';
        }

        // --- CHARTS ---
        function renderCharts() {
            const ctx1 = document.getElementById('chartGrowth').getContext('2d');
            new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei'],
                    datasets: [{
                        label: 'Penjualan Digital',
                        data: [12, 19, 3, 5, 2],
                        borderColor: '#6366f1',
                        fill: true,
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4
                    }]
                }
            });

            const ctx2 = document.getElementById('chartProfit').getContext('2d');
            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Tagihan', 'E-Wallet', 'Produk'],
                    datasets: [{
                        data: [40, 30, 30],
                        backgroundColor: ['#6366f1', '#10b981', '#f59e0b']
                    }]
                }
            });
        }

        // Init
        window.onload = () => {
            lucide.createIcons();
            updateDashboard();
        };
    </script>
</body>
</html>
