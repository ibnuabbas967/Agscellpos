<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoPOS Premium - Smart Cashier System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f1f5f9; }
        .sidebar-active { background: #6366f1; color: white; box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.3); }
        .glass-morphism { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="overflow-x-hidden">

    <div id="login-screen" class="fixed inset-0 z-[100] bg-slate-900 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-3xl p-8 shadow-2xl">
            <div class="text-center mb-8">
                <div class="bg-indigo-100 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="shield-check" class="text-indigo-600 w-8 h-8"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">NeoPOS Login</h2>
                <p class="text-slate-500">Silahkan pilih akses anda</p>
            </div>
            <div class="space-y-4">
                <button onclick="loginAs('admin')" class="w-full flex items-center justify-between p-4 border-2 border-slate-100 rounded-2xl hover:border-indigo-500 transition-all group">
                    <div class="flex items-center gap-4">
                        <i data-lucide="user-cog" class="text-slate-400 group-hover:text-indigo-500"></i>
                        <span class="font-bold text-slate-700">Administrator</span>
                    </div>
                    <i data-lucide="chevron-right" class="w-5 h-5 text-slate-300"></i>
                </button>
                <button onclick="loginAs('kasir')" class="w-full flex items-center justify-between p-4 border-2 border-slate-100 rounded-2xl hover:border-indigo-500 transition-all group">
                    <div class="flex items-center gap-4">
                        <i data-lucide="shopping-cart" class="text-slate-400 group-hover:text-indigo-500"></i>
                        <span class="font-bold text-slate-700">Staff Kasir</span>
                    </div>
                    <i data-lucide="chevron-right" class="w-5 h-5 text-slate-300"></i>
                </button>
            </div>
            <p class="text-center text-xs text-slate-400 mt-8">NeoPOS v3.0 Premium System</p>
        </div>
    </div>

    <div class="flex min-h-screen">
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-72 bg-white border-r border-slate-200 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out overflow-y-auto hide-scroll">
            <div class="p-6 flex items-center gap-3 border-b border-slate-50">
                <div class="bg-indigo-600 p-2 rounded-lg"><i data-lucide="cpu" class="text-white w-5 h-5"></i></div>
                <span class="text-xl font-extrabold text-slate-800">NeoPOS <span class="text-indigo-600">Pro</span></span>
            </div>

            <nav class="p-4 space-y-1" id="nav-menu">
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-4 mb-2">Main Menu</p>
                <a href="javascript:void(0)" onclick="showPage('dashboard')" class="nav-item flex items-center gap-3 p-3.5 rounded-xl text-slate-600 hover:bg-indigo-50 transition sidebar-active">
                    <i data-lucide="layout-grid" class="w-5 h-5"></i> Dashboard
                </a>
                <a href="javascript:void(0)" onclick="showPage('saldo')" class="nav-item flex items-center gap-3 p-3.5 rounded-xl text-slate-600 hover:bg-indigo-50 transition">
                    <i data-lucide="wallet-2" class="w-5 h-5"></i> Monitoring Saldo
                </a>
                
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-4 mt-6 mb-2">Transactions</p>
                <a href="javascript:void(0)" onclick="showPage('ewallet')" class="nav-item flex items-center gap-3 p-3.5 rounded-xl text-slate-600 hover:bg-indigo-50 transition">
                    <i data-lucide="smartphone-nfc" class="w-5 h-5"></i> E-Wallet Topup
                </a>
                <a href="javascript:void(0)" onclick="showPage('digital')" class="nav-item flex items-center gap-3 p-3.5 rounded-xl text-slate-600 hover:bg-indigo-50 transition">
                    <i data-lucide="zap" class="w-5 h-5"></i> Tagihan Digital
                </a>
                <a href="javascript:void(0)" onclick="showPage('hutang')" class="nav-item flex items-center gap-3 p-3.5 rounded-xl text-slate-600 hover:bg-indigo-50 transition">
                    <i data-lucide="book-copy" class="w-5 h-5"></i> Hutang & Piutang
                </a>

                <div id="admin-only" class="space-y-1">
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-4 mt-6 mb-2">Management</p>
                    <a href="javascript:void(0)" onclick="showPage('grafik')" class="nav-item flex items-center gap-3 p-3.5 rounded-xl text-slate-600 hover:bg-indigo-50 transition">
                        <i data-lucide="pie-chart" class="w-5 h-5"></i> Grafik & Profit
                    </a>
                    <a href="javascript:void(0)" onclick="showPage('produk')" class="nav-item flex items-center gap-3 p-3.5 rounded-xl text-slate-600 hover:bg-indigo-50 transition">
                        <i data-lucide="package" class="w-5 h-5"></i> Kelola Barang
                    </a>
                </div>

                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-4 mt-6 mb-2">System</p>
                <a href="javascript:void(0)" onclick="showPage('pengaturan')" class="nav-item flex items-center gap-3 p-3.5 rounded-xl text-slate-600 hover:bg-indigo-50 transition">
                    <i data-lucide="settings" class="w-5 h-5"></i> Pengaturan
                </a>
                <a href="javascript:void(0)" onclick="logout()" class="flex items-center gap-3 p-3.5 rounded-xl text-rose-500 hover:bg-rose-50 transition">
                    <i data-lucide="log-out" class="w-5 h-5"></i> Keluar
                </a>
            </nav>
        </aside>

        <main class="flex-1 lg:ml-72 min-h-screen">
            <div class="lg:hidden p-4 flex justify-between items-center bg-white border-b sticky top-0 z-30">
                <span class="font-bold text-indigo-600">NeoPOS Pro</span>
                <button onclick="toggleSidebar()" class="p-2 bg-slate-100 rounded-lg"><i data-lucide="menu"></i></button>
            </div>

            <div class="p-6 lg:p-10">
                <section id="saldo" class="page-content hidden space-y-6">
                    <div class="mb-8">
                        <h1 class="text-3xl font-extrabold text-slate-800">Monitoring Saldo</h1>
                        <p class="text-slate-500">Status keuangan kas dan bank saat ini</p>
                    </div>

                    <div class="flex flex-col gap-6 max-w-xl">
                        <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 flex items-center gap-6">
                            <div class="bg-emerald-100 p-4 rounded-2xl text-emerald-600"><i data-lucide="banknote" class="w-8 h-8"></i></div>
                            <div>
                                <p class="text-sm font-semibold text-slate-400">Total Uang Kas</p>
                                <h2 class="text-2xl font-black text-slate-800" id="v-saldo-kas">Rp 0</h2>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 flex items-center gap-6">
                            <div class="bg-blue-100 p-4 rounded-2xl text-blue-600"><i data-lucide="landmark" class="w-8 h-8"></i></div>
                            <div>
                                <p class="text-sm font-semibold text-slate-400">Total Saldo Bank</p>
                                <h2 class="text-2xl font-black text-slate-800" id="v-saldo-bank">Rp 0</h2>
                            </div>
                        </div>
                        <div class="bg-indigo-600 p-8 rounded-[2rem] shadow-xl shadow-indigo-200 text-white">
                            <p class="text-indigo-200 text-sm font-bold uppercase tracking-widest mb-2">Total Gabungan (Net Worth)</p>
                            <h2 class="text-4xl font-black" id="v-total-gabungan">Rp 0</h2>
                        </div>
                    </div>
                </section>

                <section id="ewallet" class="page-content hidden">
                    <div class="max-w-4xl bg-white rounded-3xl shadow-sm border p-8">
                        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i data-lucide="smartphone-nfc" class="text-indigo-600"></i> Transaksi E-Wallet</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="col-span-1 md:col-span-2">
                                <label class="block text-sm font-bold mb-2">Pilih Pelanggan</label>
                                <select id="ew-pelanggan" class="w-full p-4 rounded-2xl border bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none">
                                    <option value="Umum">Pelanggan Umum</option>
                                    <option value="Member 1">Budi Setiawan</option>
                                    <option value="Member 2">Siti Aminah</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-2">Jenis Layanan</label>
                                <select id="ew-layanan" onchange="toggleEwalletUI()" class="w-full p-4 rounded-2xl border bg-slate-50">
                                    <option value="topup">Topup Dana (Beli)</option>
                                    <option value="tarik">Tarik Tunai (Cairkan)</option>
                                </select>
                            </div>
                            <div id="ew-posisi-admin-container">
                                <label class="block text-sm font-bold mb-2">Biaya Admin</label>
                                <select id="ew-posisi-admin" class="w-full p-4 rounded-2xl border bg-slate-50">
                                    <option value="luar">Admin DI LUAR (Bayar: Harga + Fee)</option>
                                    <option value="dalam">Admin DI DALAM (Potong Saldo)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-2">Nominal Saldo</label>
                                <input type="number" id="ew-nominal" class="w-full p-4 rounded-2xl border bg-slate-50" placeholder="0">
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-2">Fee Admin Toko</label>
                                <input type="number" id="ew-fee" class="w-full p-4 rounded-2xl border bg-slate-50" value="2000">
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-2">Tipe Pembayaran</label>
                                <select id="ew-tipe-bayar" class="w-full p-4 rounded-2xl border bg-slate-50">
                                    <option value="full">Bayar Penuh</option>
                                    <option value="sebagian">Bayar Sebagian</option>
                                    <option value="hutang">Hutang Full</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-2">Metode</label>
                                <select id="ew-metode" class="w-full p-4 rounded-2xl border bg-slate-50">
                                    <option value="kas">Uang Kas</option>
                                    <option value="bank">Saldo Bank</option>
                                </select>
                            </div>
                        </div>

                        <div id="ew-notif-card" class="mb-6 p-4 rounded-2xl bg-indigo-50 border border-indigo-100 hidden">
                            <div class="flex items-center gap-3">
                                <div id="ew-notif-icon" class="p-2 rounded-xl bg-white text-indigo-600"><i data-lucide="info"></i></div>
                                <div>
                                    <p id="ew-notif-title" class="font-bold text-indigo-900 text-sm">Status Alur Keuangan</p>
                                    <p id="ew-notif-desc" class="text-xs text-indigo-700">Penjelasan otomatis alur uang...</p>
                                </div>
                            </div>
                        </div>

                        <button onclick="prosesEwallet()" class="w-full bg-indigo-600 text-white p-5 rounded-2xl font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition">Simpan Transaksi E-Wallet</button>
                    </div>
                </section>

                <section id="hutang" class="page-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-white rounded-3xl p-8 shadow-sm border">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-slate-800">Daftar Piutang (Pelanggan)</h3>
                                <span class="bg-rose-100 text-rose-600 px-3 py-1 rounded-full text-xs font-bold">Uang diluar</span>
                            </div>
                            <div id="list-piutang" class="space-y-4 max-h-[500px] overflow-y-auto pr-2">
                                </div>
                        </div>

                        <div class="bg-white rounded-3xl p-8 shadow-sm border">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-slate-800">Hutang Toko (Ke Pihak Lain)</h3>
                                <span class="bg-slate-100 text-slate-600 px-3 py-1 rounded-full text-xs font-bold">Kewajiban</span>
                            </div>
                            <div id="list-hutang-toko" class="space-y-4">
                                </div>
                        </div>
                    </div>
                </section>

                <section id="grafik" class="page-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-2 bg-white p-6 rounded-3xl border shadow-sm">
                            <h3 class="font-bold mb-4">Pertumbuhan Penjualan Digital & E-Wallet</h3>
                            <canvas id="mainChart" height="150"></canvas>
                        </div>
                        <div class="bg-indigo-900 text-white p-8 rounded-3xl shadow-xl flex flex-col justify-between">
                            <div>
                                <p class="text-indigo-300 text-sm font-bold uppercase tracking-widest">Total Profit Bersih</p>
                                <h2 class="text-4xl font-black mt-2" id="v-profit-total">Rp 0</h2>
                            </div>
                            <div class="pt-6 border-t border-indigo-800 mt-6 space-y-4">
                                <div class="flex justify-between">
                                    <span class="text-indigo-300">Harian</span>
                                    <span class="font-bold" id="v-profit-hari">Rp 0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-indigo-300">Mingguan</span>
                                    <span class="font-bold" id="v-profit-minggu">Rp 0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-indigo-300">Bulanan</span>
                                    <span class="font-bold" id="v-profit-bulan">Rp 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="pengaturan" class="page-content hidden">
                    <div class="max-w-2xl mx-auto bg-white rounded-3xl p-8 border shadow-sm">
                        <h2 class="text-xl font-bold mb-8">Konfigurasi Sistem</h2>
                        <div class="space-y-6">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-400 mb-2 uppercase">Modal Awal Kas</label>
                                    <input type="number" id="set-awal-kas" class="w-full p-4 rounded-2xl border bg-slate-50 font-bold" placeholder="0">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-400 mb-2 uppercase">Modal Awal Bank</label>
                                    <input type="number" id="set-awal-bank" class="w-full p-4 rounded-2xl border bg-slate-50 font-bold" placeholder="0">
                                </div>
                            </div>
                            <button onclick="setInitialModal()" class="w-full bg-slate-900 text-white p-4 rounded-2xl font-bold hover:bg-black transition">Terapkan Perubahan</button>
                            
                            <div class="pt-8 border-t">
                                <p class="text-center font-bold text-slate-800">NeoPOS Premium v3.0.1</p>
                                <p class="text-center text-sm text-slate-400">Database Engine: Google Apps Script API</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // CONFIG & STATE
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxE516Tqna_RKNuVgOpU0x9rnzf5O6lB0VOMLRKdVDYoIGRk89POCTiQzF8Q-1txjc40Q/exec";
        
        let state = {
            user: null,
            saldoKas: 0,
            saldoBank: 0,
            transaksi: [],
            piutang: [],
            hutangToko: [
                { pihak: "Distributor Pulsa", nominal: 1500000, tgl: "2023-10-01" },
                { pihak: "Vendor E-Money", nominal: 2000000, tgl: "2023-10-05" }
            ]
        };

        // UI INITIALIZATION
        function loginAs(role) {
            state.user = role;
            document.getElementById('login-screen').classList.add('hidden');
            if(role === 'kasir') {
                document.getElementById('admin-only').classList.add('hidden');
            } else {
                document.getElementById('admin-only').classList.remove('hidden');
            }
            showPage('dashboard');
            Swal.fire('Selamat Datang!', `Berhasil login sebagai ${role.toUpperCase()}`, 'success');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            
            // Update Active Menu
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('sidebar-active'));
            event?.currentTarget?.classList?.add('sidebar-active');

            if(window.innerWidth < 1024) toggleSidebar();
            if(pageId === 'grafik') initCharts();
            lucide.createIcons();
            updateUI();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
        }

        // FORMATTER
        const rf = (num) => "Rp " + new Intl.NumberFormat('id-ID').format(num);

        // REAL-TIME UI UPDATE
        function updateUI() {
            document.getElementById('v-saldo-kas').innerText = rf(state.saldoKas);
            document.getElementById('v-saldo-bank').innerText = rf(state.saldoBank);
            document.getElementById('v-total-gabungan').innerText = rf(state.saldoKas + state.saldoBank);

            // Update Piutang List
            const listP = document.getElementById('list-piutang');
            listP.innerHTML = state.piutang.length ? '' : '<p class="text-slate-400 text-center py-8">Tidak ada piutang</p>';
            state.piutang.forEach((p, idx) => {
                listP.innerHTML += `
                    <div class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100">
                        <div>
                            <p class="font-bold text-slate-800">${p.nama}</p>
                            <p class="text-xs text-rose-500 font-bold">${rf(p.nominal)}</p>
                        </div>
                        <button onclick="bayarPiutang(${idx})" class="bg-white text-indigo-600 border border-indigo-100 px-4 py-2 rounded-xl text-xs font-bold hover:bg-indigo-600 hover:text-white transition">Bayar</button>
                    </div>
                `;
            });

            // Update Hutang Toko List
            const listH = document.getElementById('list-hutang-toko');
            listH.innerHTML = '';
            state.hutangToko.forEach((h, idx) => {
                listH.innerHTML += `
                    <div class="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100">
                        <div>
                            <p class="font-bold text-slate-800">${h.pihak}</p>
                            <p class="text-xs text-slate-500">${rf(h.nominal)}</p>
                        </div>
                        <button onclick="bayarHutangToko(${idx})" class="bg-slate-900 text-white px-4 py-2 rounded-xl text-xs font-bold">Lunasi</button>
                    </div>
                `;
            });
        }

        // CORE LOGIC: E-WALLET
        function toggleEwalletUI() {
            const layanan = document.getElementById('ew-layanan').value;
            const notif = document.getElementById('ew-notif-card');
            const desc = document.getElementById('ew-notif-desc');
            const title = document.getElementById('ew-notif-title');
            
            notif.classList.remove('hidden');
            if(layanan === 'topup') {
                title.innerText = "Pemasukan (Uang Masuk)";
                desc.innerText = "Pelanggan memberikan uang CASH ke Kasir, kita mentransfer SALDO Digital kita ke mereka.";
            } else {
                title.innerText = "Pengeluaran (Uang Kas Keluar)";
                desc.innerText = "Pelanggan mentransfer SALDO ke kita, kita memberikan uang CASH dari laci kasir ke mereka.";
            }
            lucide.createIcons();
        }

        function prosesEwallet() {
            const nominal = parseInt(document.getElementById('ew-nominal').value) || 0;
            const fee = parseInt(document.getElementById('ew-fee').value) || 0;
            const layanan = document.getElementById('ew-layanan').value;
            const metode = document.getElementById('ew-metode').value;
            const tipe = document.getElementById('ew-tipe-bayar').value;
            const nama = document.getElementById('ew-pelanggan').value;

            if(nominal <= 0) return Swal.fire('Error', 'Nominal harus diisi', 'error');

            let totalTransaksi = (layanan === 'topup') ? nominal + fee : nominal - fee;
            
            // Logika saldo & hutang sederhana
            if(layanan === 'topup') {
                // Topup: Kita keluar saldo bank/digital, kita terima cash
                state.saldoBank -= nominal; 
                if(tipe === 'full') {
                    if(metode === 'kas') state.saldoKas += totalTransaksi;
                    else state.saldoBank += totalTransaksi;
                } else if(tipe === 'hutang') {
                    state.piutang.push({ nama, nominal: totalTransaksi, tgl: new Date().toISOString() });
                }
            } else {
                // Tarik: Kita keluar cash, kita terima saldo bank/digital
                state.saldoBank += nominal; 
                if(metode === 'kas') state.saldoKas -= (nominal - fee);
            }

            // Sync ke Google Sheets (Simulasi)
            kirimKeSheet({
                jenis: "E-WALLET",
                layanan,
                nama,
                nominal,
                total: totalTransaksi
            });

            Swal.fire('Berhasil!', 'Transaksi E-Wallet telah diproses dan dicatat', 'success');
            updateUI();
        }

        function setInitialModal() {
            state.saldoKas = parseInt(document.getElementById('set-awal-kas').value) || 0;
            state.saldoBank = parseInt(document.getElementById('set-awal-bank').value) || 0;
            updateUI();
            Swal.fire('Sukses', 'Modal awal berhasil dikonfigurasi', 'success');
        }

        function kirimKeSheet(data) {
            // Contoh implementasi fetch ke URL AppScript Anda
            console.log("Kirim data ke Google Sheets:", data);
            // fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) });
        }

        function initCharts() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                    datasets: [{
                        label: 'Profit (Rp)',
                        data: [500000, 750000, 450000, 900000, 1200000, 850000],
                        backgroundColor: '#6366f1',
                        borderRadius: 12
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function logout() {
            state.user = null;
            document.getElementById('login-screen').classList.remove('hidden');
        }

        // Load Default
        window.onload = () => {
            lucide.createIcons();
            updateUI();
        };
    </script>
</body>
</html>
